---
title: postconf
description: postfix インスタンスの設定情報管理ツール
tags:
    - "Linux"
    - "メール管理"
sidebar:
    # このリンクのカスタムラベルを設定します
    label: postconf
    # このリンクの順番をカスタマイズします（数字が小さいほど上に表示されます）
    order: 2
    # このリンクにバッジを追加します
    # badge:
    #     text: ""
    #     variant: tip
---

import { LinkCard, Tabs, TabItem } from "@astrojs/starlight/components";
import LinkPreview from "@components/LinkPreview.astro";
// import MermaidChart from "@components/MermaidChart.astro";
import Table from "@components/Table.astro";

## 概要

`postconf` コマンドは、Postfix の設定ファイルを管理するためのユーティリティです。
管理者が main.cf や master.cf ファイル内の設定を表示、編集、操作するのに使用されます。  
postconf は、Postfix というメール転送エージェント（MTA）の設定を管理・表示するために使用され、
主に main.cf（一般設定用）と master.cf（サービスごとの設定用）のファイルを管理するために利用されます。

### 構文

```bash frame=none
postconf オプション
```

<LinkPreview url="https://vpslife.server-memo.net/postfix_postconf/#google_vignette" />

#### オプションリスト

<Table
    caption=""
    columns={["Option", "Description"]}
    data={[
        [
            "-c config_dir",
            "引数に Postfix インスタンスのディレクトリを指定することで対象のインスタンスの設定ファイルを指定できる",
        ],
        ["-C class, …", "特定のクラス(builtin、service、user、all) からパラメータを表示"],
        ["-v", "デバッグ目的で詳細なログを有効にする"],
        ["-f", "人間が読みやすいように長い行を折り返す"],
        ["-h", "値の前に名前を表示しないでパラメータや属性の値を表示"],
        ["-H", "名前の後に値を表示しないでパラメータや属性の名前を表示"],
        ["-o name=value", "一時的に main.cf のパラメータ設定をオーバーライド"],
    ]}
/>

## main.cf の設定管理

### 構文

```bash frame=none
postconf [parameter...]
```

#### オプションリスト

<Table
    caption=""
    columns={["Option", "Description"]}
    data={[
        ["-d", "デフォルト値のパラメータ設定を表示"],
        ["-n", "main.cf に明示的に設定されたパラメータのみを表示"],
        ["-p", "現在のパラメータ設定を表示"],
        ["-e parameter=value …", "パラメータ設定を直接変更(一度に複数の設定を指定可)"],
        ["-x parameter_name …", "変数を展開して表示する(一度に複数指定可)"],
        ["-X parameter", "設定のパラメータを削除"],
        ["-# parameter", "特定のパラメータをコメントアウトして、デフォルト値に戻す"],
    ]}
/>

### 設定項目

<LinkPreview url="https://www.postfix-jp.info/trans-2.3/jhtml/postconf.5.html" />

#### smtp_connection_cache_on_demand

##### value

`yes | no`

##### 説明

SMTP 接続キャッシュの有効性

#### minimal_backoff_time

##### value

`100s`

##### 説明

メールの再送を試みるまでの最小遅延時間を指定  
100s で 100 秒

#### maximal_backoff_time

##### value

`300s`

##### 説明

メールの再送を試みるまでの最大遅延時間を指定

#### maximal_queue_lifetime

##### value

`1h`

##### 説明

キュー内でメールを保持する最大時間、
メールが指定時間内に配送されないと配送に失敗したとみなす。

#### bounce_queue_lifetime

##### value

`1h`

##### 説明

バウンスしたメールをキューに保持する最大時間  
バウンスメールが 1 時間以内に配信されない場合、それ以上の試行は行われません。

#### queue_run_delay

##### value

`300s`

##### 説明

キュー内のメールの処理を開始するまでの遅延時間

#### default_destination_recipient_limit

##### value

`1000`

##### 説明

1 つの宛先に対する送信可能な最大受信者数を指定  
Postfix は、1 つの宛先に対して最大 1000 人の受信者にメールを送信できる。
大規模なメーリングリストや、同じドメインの多くの受信者にメールを送信する場合に有効

#### default_process_limit

##### value

`100`

##### 説明

同時に実行できる Postfix プロセスの最大数を指定  
メール送信の並列処理実行を行うプロセスの最大数

#### smtputf8_enable

##### value

`yes | no`

##### 説明

SMTPUTF8 のサポートの有効性
メールアドレスのローカルパート(@より前の部分)に非 ASCII 文字を利用できるかどうか。
no で扱わないように指定

#### append_dot_mydomain

##### value

`yes | no`

##### 説明

mydomain をメールアドレスに追加するかどうかを指定  
user 形式のメールアドレスにドメインを追加して、user@mydomain の形式するかどうかを指定する。  
不完全なメールアドレスを補完するために使用される

#### internal_mail_filter_classes

##### value

##### 説明

#### mynetworks

##### value

`172.192.10.1, 58.60.10.1/24`

##### 説明

mynetworks (default: see postconf -d output)
The list of "trusted" remote SMTP clients that have more privileges than "strangers".

In particular, "trusted" SMTP clients are allowed to relay mail through Postfix.  
See the smtpd_relay_restrictions parameter description in the postconf(5) manual.

You can specify the list of "trusted" network addresses by hand or you can let Postfix do it for you (which is the default).  
See the description of the mynetworks_style parameter for more information.

If you specify the mynetworks list by hand, Postfix ignores the mynetworks_style setting.

Specify a list of network addresses or network/netmask patterns,
separated by commas and/or whitespace. Continue long lines by starting the next line with whitespace.

The netmask specifies the number of bits in the network part of a host address.  
You can also specify "/file/name" or "type:table" patterns.  
A "/file/name" pattern is replaced by its contents; a "type:table" lookup table is matched when a table entry matches a lookup string (the lookup result is ignored).

The list is matched left to right, and the search stops on the first match.  
Specify "!pattern" to exclude an address or network block from the list.
The form "!/file/name" is supported only in Postfix version 2.4 and later.

Note 1: Pattern matching of domain names is controlled by the presence or absence of "mynetworks" in the parent_domain_matches_subdomains parameter value.

Note 2: IP version 6 address information must be specified inside [] in the mynetworks value, and in files specified with "/file/name".  
IP version 6 addresses contain the ":" character, and would otherwise
be confused with a "type:table" pattern.

Note 3: CIDR ranges cannot be specified in hash tables. Use cidr tables if CIDR ranges are used.

Examples:

```bash frame=none
mynetworks = 127.0.0.0/8 168.100.189.0/28
mynetworks = !192.168.0.1, 192.168.0.0/28
mynetworks = 127.0.0.0/8 168.100.189.0/28 [::1]/128 [2001:240:587::]/64
mynetworks = $config_directory/mynetworks
mynetworks = hash:/etc/postfix/network_table
mynetworks = cidr:/etc/postfix/network_table.cidr
```

## master.cf のサービスエントリの管理

### オプションリスト

<Table
    caption=""
    columns={["Option", "Description"]}
    data={[
        ["-M service/type …", "master.cf の内容を表示(サービスエントリの表示)"],
        ["-M service/type=value …", "サービスエントリの編集: `master.cf`内のサービスエントリを変更"],
        ["-MX service/type …", "サービスエントリの削除"],
        ["-F service/type/field …", "フィールドの表示"],
        ["-F service/type/field=value …", "フィールドの編集"],
        ["-P service/type/parameter …", "パラメータの表示"],
        ["-P service/type/parameter=value …", "パラメータの編集"],
    ]}
/>

### 設定の追加例

1. サービスの変更前にはバックアップ

    ```bash frame=none
    cp /etc/postfix/master.cf /etc/postfix/master.cf.bak
    ```

2. サービスエントリを追加

    ```bash frame=none
    postconf -M slow/unix='slow unix - - n - - smtp'
    ```

3. サービスパラメータを追加

    ```bash frame=none
    postconf -P slow/unix/syslog_name='syslog_name=postfix-slow'
    ```

4. Postfix サービスの再起動

    ```bash frame=none
    systemctl restart postfix
    ```

5. 設定の反映を確認

    ```bash frame=none
    postconf -M slow
    ```

## バウンスメッセージテンプレートの管理

### バウンスメッセージ用のオプション

<Table
    caption=""
    columns={["Option", "Description"]}
    data={[
        ["-b [template_file]", "バウンステンプレートの表示:"],
        ["-t [template_file]", "テンプレートテキストの表示"],
    ]}
/>

## TLS 機能の管理

<Table caption="" columns={["Option", "Description"]} data={[["-T mode", "TLS 情報の表示:"]]} />

## その他設定管理

<Table
    caption=""
    columns={["Option", "Description"]}
    data={[
        ["-a | -A", "SASL プラグインのリスト"],
        ["-l", "メールボックスロック方法のリスト"],
        ["-m", "サポートされているルックアップテーブルタイプのリスト"],
    ]}
/>

## Sample

#### 設定ファイルを指定して、設定項目の変更

```bash frame=none
postconf -c /etc/postfix-xxx -e authorized_submit_users=static:anyone
```

`-c config_directory` で特定の Postfix インスタンスの設定ディレクトリを指定、  
`-e key=value` で特定の値を設定。 `authorized_submit_users` を
`static:anyone` にすると、任意のユーザーがメールを送信できるようにする。

```bash frame=none
sub="sub"
postconf -c /etc/postfix-${sub} -e transport_maps=hash:/etc/postfix-${sub}/transport
```

メールの配送ルールを定義するための transport ファイルのマッピング設定を定義

#### postfix のバージョンを確認

```bash frame=none
postconf | grep mail_version
mail_version = 3.8.6
milter_macro_v = $mail_name $mail_version
```

#### postfix の IP 設定を変更する

```bash frame=none
# inet_interfaces の設定値を確認
postconf -c /etc/postfix-1 -h inet_interfaces
# inet_interfaces に IP アドレス値を設定
postconf -c /etc/postfix-1 -e inet_interfaces="$WAN_IP"
```
