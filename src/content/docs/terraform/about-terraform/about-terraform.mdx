---
title: Terraform とは
description: Terraform についての基本知識
tags:
    - "Terraform"
sidebar:
    # このリンクのカスタムラベルを設定します
    label: Terraform とは
    # このリンクの順番をカスタマイズします（数字が小さいほど上に表示されます）
    order: 1
    # このリンクにバッジを追加します
    # badge:
    #     text: ""
    #     variant: tip
---

import { LinkCard, Tabs, TabItem, Steps } from "@astrojs/starlight/components";
import LinkPreview from "@components/LinkPreview.astro";
import Table from "@components/Table.astro";

## 基本

### Terraform とは

<LinkPreview url="https://www.terraform.io/" />

terraform は Iac と呼ばれるツールの一種で、インフラの構成をソースコードとして管理できる機能です。

注意点として、あくまで管理できるのはインフラ構成であって、サーバー内のユーザー設定やライブラリのインストールなどはできません。

もし、サーバー内も管理したい場合は、image でデプロイするか、ansible などを併用して管理していく必要が出てきます。

-   クラウドリソースやサービスを宣言的なコードで定義
-   複数のクラウドプロバイダ(AWS, Azure, GCP など)に対応
-   インフラの状態を追跡し、変更を効率的に管理

### インストール

[Terraform インストール](/terraform/about-terraform/install-terraform/)

### 設定ファイルの作成とプランの実行

<LinkPreview url="https://developer.hashicorp.com/terraform/intro#how-does-terraform-work" />

<Steps>
1. **初期化**

    ```bash frame=none
    terraform init
    ```
    [terraform init](/terraform/cmds/main-commands/init/)

1. **リソースの定義**

    `.tf` 拡張子を持つ HashiCorp Configuration Language (HCL)ファイルを作成

    設定ファイルで、インフラの定義

    ```tf
    resource "aws_instance" "example" {
        ami           = "ami-0c55b159cbfafe1f0"
        instance_type = "t2.micro"
    }
    ```

1. **プランの確認**

    ```bash frame=none
    terraform plan
    ```

    [terraform plan](/terraform/cmds/main-commands/plan/)

    既存のインフラストラクチャと構成に基づいて、作成、更新、または破棄するインフラストラクチャを記述する実行計画を作成

1. **インフラストラクチャの適用**

    ```bash frame=none
    terraform apply
    ```

    [terraform apply](/terraform/cmds/main-commands/apply/)

    承認されると、Terraform はリソースの依存関係を尊重しながら、提案された操作を正しい順序で実行します。

    ![The core Terraform workflow consists of three stages](https://developer.hashicorp.com/_next/image?url=https%3A%2F%2Fcontent.hashicorp.com%2Fapi%2Fassets%3Fproduct%3Dterraform%26version%3Drefs%252Fheads%252Fv1.9%26asset%3Dwebsite%252Fimg%252Fdocs%252Fintro-terraform-workflow.png%26width%3D2038%26height%3D1773&w=2048&q=75&dpl=dpl_HqztsgLFJfaFoCSA2P2Y4dshE8zr)

1. **インフラの削除**

    ```bash frame=none
    terraform destroy
    ```

    [terraform destroy](/terraform/cmds/main-commands/destroy/)

</Steps>

## フォルダ構成

### .terraform

`terraform init` を実行するとプロバイダにアクセスするためのプラグインをインストールし以下のようなファイル構成を生成する。

> ex. aws プロバイダに `terraform init` を実行した際の構成

```
.
├── .terraform
│   └── providers
│       └── registry.terraform.io
│           └── hashicorp
│               └── aws
│                   └── 5.67.0
│                       └── darwin_arm64
│                           ├── LICENSE.txt
│                           └── terraform-provider-aws_v5.67.0_x5
├── .terraform.lock.hcl
└── iac.tf
```

### ロックファイル(.lock.hcl)

プロバイダのプラグインをインストールした際のプラグインリストを記載したファイル

これがあることで、`terraform apply` をシンプルに実現することができる。

### .tfstate

terraform で作成したリソースの設計を用意している。

### .ftstate.backup

destroy やリソースの削除など、前回の `terraform apply` が実行された結果が残されている。
