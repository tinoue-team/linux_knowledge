---
title: plan
description: 現在の設定に基づき、インフラストラクチャの適用内容を確認する
tags:
    - "Terraform commands"
sidebar:
    # このリンクのカスタムラベルを設定します
    label: plan
    # このリンクの順番をカスタマイズします（数字が小さいほど上に表示されます）
    order: 2
    # このリンクにバッジを追加します
    # badge:
    #     text: ""
    #     variant: tip
---

import { LinkCard, Tabs, TabItem } from "@astrojs/starlight/components";
import LinkPreview from "@components/LinkPreview.astro";
import Table from "@components/Table.astro";

## 説明

### 解説

現在の設定を適用した場合に Terraform が実行するアクションを示す、仮想的な実行プランを生成します。実際に変更を適用する前に、追加、変更、削除されるリソースを確認できます。このコマンドは安全で、インフラに対して実際の変更を行いません。

このコマンドは実際にはプランされたアクションを実行しません。

オプションでプランをファイルに保存することができ、そのファイルを"apply" コマンドに渡すことで、プランに記述されたアクションを正確に実行することができます。

#### 主な用途

-   変更内容の確認: インフラに対する変更が意図したものかを事前に確認できます。
-   プランの保存: `-out` オプションを使用してプランをファイルに保存し、後でそのプランを適用できます。
-   CI/CD パイプラインとの統合: `-detailed-exitcode` を使用して、変更の有無に基づいてパイプラインのフローを制御できます。

### 構文

```bash
terraform [global options] plan [options]
```

### プランカスタマイズオプション

以下のオプションは、Terraform がプランを生成する方法をカスタマイズします。
保存されたプランを渡さずに `terraform apply` を実行する際にも、これらのオプションを使用して一度にプランと適用を行うことができます。

<Table
    caption=""
    columns={["Option", "説明"]}
    data={[
        [
            "-destroy",
            [
                "'destroy' プランニングモードを選択します。通常の動作の代わりに、このTerraform設定で現在管理されているすべてのオブジェクトを削除するプランを作成します。",
            ].join("<br/>"),
        ],
        [
            "-refresh-only",
            [
                " 'refresh only' のプランニングモードを選択します。これはリモートオブジェクトが最新のTerraform適用結果と一致しているかを確認しますが、Terraform 外で行われた変更を元に戻すアクションは提案しません。",
            ].join("<br/>"),
        ],
        [
            "-refresh=false",
            [
                "プラン作成中にリモートオブジェクトへの外部変更をチェックするのをスキップします。",
                "これによりプランニングが高速化される可能性がありますが、リモートシステムの古い状態に基づいてプランニングされるリスクがあります。"
            ].join("<br/>"),
        ],
        [
            "-replace=resource",
            [
                "リソースアドレスを使用して特定のリソースインスタンスの置換を強制します。",
                "通常、このインスタンスに対して更新または何もしないアクションが生成される場合でも、Terraformは代わりにそれを置換するプランを作成します。",
                "複数のオブジェクトを置換する場合、このオプションを複数回使用できます。"
            ].join("<br/>"),
        ],
        [
            "-target=resource",
            [
                "プランニング操作を指定したモジュール、リソース、またはリソースインスタンスとそのすべての依存関係のみに制限します。",
                "複数のオブジェクトを含める場合、このオプションを複数回使用できます。これは例外的な場合にのみ使用してください。"
            ].join("<br/>")
        ],
        ["-var 'foo=bar'", ["設定のルートモジュール内の入力変数に値を設定します。複数の変数を設定するには、このオプションを複数回使用します。"].join("<br/>")],
        [
            "-var-file=filename",
            [
                "デフォルトのファイル `terraform.tfvars` および `*.auto.tfvars` に加えて、指定されたファイルから変数値を読み込みます。",
                "複数の変数ファイルを含めるには、このオプションを複数回使用します。"
            ].join("<br/>"),
        ]

    ]}

/>

### その他のオプション

<Table
    caption=""
    columns={["Option", "説明"]}
    data={[
        [
            "-compact-warnings",
            [
                "エラーを伴わない警告がある場合、要約メッセージのみを含むよりコンパクトな形式で表示します。",
            ].join("<br/>"),
        ],
        [
            "-detailed-exitcode",
            [
                "コマンド終了時に詳細な終了コードを返す。",
                "終了コードの意味が以下のように変更されます",
                "- `0`: 成功、差分なし（変更なし）",
                "- `1`: エラー発生",
                "- `2`: 成功、差分あり",
            ].join("<br/>"),
        ],
        [
            "-generate-config-out=path",
            [
                "（実験的）設定に import ブロックが存在する場合、まだ存在しないインポートされたリソースのHCLを生成するようにTerraformに指示します。",
                "設定は PATH で指定された新しいファイルに書き込まれます。このファイルは既に存在していてはいけません。プランがエラーになった場合でも、Terraformは設定を書き込もうとする場合があります。"
            ].join("<br/>"),
        ],
        [
            "-input=true",
            [
                "直接設定されていない変数の入力を求めます。"
            ].join("<br/>"),
        ],
        [
            "-out=path",
            [
                "プランファイルを指定されたパスに書き込みます。これは `apply` コマンドへの入力として使用できます。",
            ].join("<br/>")
        ],
        [
            "-parallelism=n",
            [
                "同時に実行する操作の数を制限します。デフォルトは `10` です。",
            ].join("<br/>")
        ],
        [
            "-state=statefile",
            [
                "ローカルバックエンドのみで使用されるレガシーオプションです。詳細はローカルバックエンドのドキュメントを参照してください。",
            ].join("<br/>")
        ],
    ]}

/>

## Sample

```bash frame="none"
terraform plan

# プランの保存
terraform plan -out=output.txt
```
