---
title: workspace
description: ワークスペースの管理を行います。複数の作業環境を切り替える際に使用する。
tags:
    - "Terraform commands"
sidebar:
    # このリンクのカスタムラベルを設定します
    label: workspace
    # このリンクの順番をカスタマイズします（数字が小さいほど上に表示されます）
    order: 2
    # このリンクにバッジを追加します
    # badge:
    #     text: ""
    #     variant: tip
---

import { LinkCard, Tabs, TabItem, Steps, FileTree } from "@astrojs/starlight/components";
import LinkPreview from "@components/LinkPreview.astro";
import Table from "@components/Table.astro";

## 説明

### 解説

Terraform ワークスペースの新規作成、リストアップ、表示、選択、削除

```bash
terraform [global options] workspace
```

### Subcommands

<Table
    caption=""
    columns={["Option", "説明"]}
    data={[
        ["delete", ["ワークスペースの削除"].join("<br/>")],
        ["list", ["ワークスペースのリストアップ"].join("<br/>")],
        ["new", ["ワークスペースの新規作成"].join("<br/>")],
        ["select", ["ワークスペースの選択して切り替える"].join("<br/>")],
        ["show", ["現在のワークスペースを表示"].join("<br/>")],
    ]}
/>

### workspace コマンドのフロー

<Steps>

1.  **現在の Terraform プロジェクトのワークスペースを確認**

    ```bash frame=none
    terraform workspace list
    # まだ何も作成していないと default のみ (* で現在の workspace をマークしている)
    * default
    ```

1.  **新しいワークスペースの作成**

    たとえば、環境毎にインフラストラクチャの状態を管理することを考え、'dev' というワークスペースを作成する

    ```bash frame="none"
    # 新しいワークスペースの作成
    terraform workspace new dev
    ```

    この作成と同時に、プロジェクトのルート階層に terraform.tfstate.d というディレクトリが作成され、  
    その中に 'dev' ディレクトリが作成される。

1.  **ワークスペースにおけるインフラストラクチャの実行を行う**

    ```bash frame="none"
    terraform apply \
        -var-file=vars/dev/.secret/secret.tfvars \
        -var-file=vars/dev/network/vpc.tfvars \
        -var "tag_name_prefix=project-dev"
    ```

    インフラストラクチャの作成を実行すると、dev の配下に tfstate ファイルが作成される

    <FileTree>

        - project/
            - main.tf
            - terraform.tfstate.d/ # 個別で作成されたワークスペースの tfstate が格納される
                - dev/
                    - terraform.tfstate
            - terraform.tfstate # default のワークスペース

    </FileTree>

1.  **違うワークスペースが存在する場合は以下のように切り替えることができる**

    ```bash frame="none"
    # 現在のワークスペースを確認
    terraform workspace list
    default
    * dev
    prod
    # ワークスペースの切り替え
    terraform workspace select prod
    ```

</Steps>

#### 参考

-   <LinkPreview
        url="https://envader.plus/article/221#Terraform%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8Bworkspace%E3%81%A8%E3%81%AF%EF%BC%9F"
        type="inline"
    />
