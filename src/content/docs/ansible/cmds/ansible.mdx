---
title: ansible
description: ansible について
tags:
  - "Ansible"
sidebar:
  # このリンクのカスタムラベルを設定します
  label: ansible
  # このリンクの順番をカスタマイズします（数字が小さいほど上に表示されます）
  order: 10
  # このリンクにバッジを追加します
  # badge:
  #     text: ""
  #     variant: tip
---

import { LinkCard, Tabs, TabItem, Steps } from "@astrojs/starlight/components";
import LinkPreview from "@components/LinkPreview.astro";
import MermaidChart from "@components/MermaidChart.astro";
import Table from "@components/Table.astro";

## ansible コマンドとは

### 構文

Define and run a single task 'playbook' against a set of hosts

```bash frame=none
ansible [-h] [--version] [-v] [-b] [--become-method BECOME_METHOD] [--become-user BECOME_USER] [-K | --become-password-file BECOME_PASSWORD_FILE] [-i INVENTORY]
        [--list-hosts] [-l SUBSET] [-P POLL_INTERVAL] [-B SECONDS] [-o] [-t TREE] [--private-key PRIVATE_KEY_FILE] [-u REMOTE_USER] [-c CONNECTION] [-T TIMEOUT]
        [--ssh-common-args SSH_COMMON_ARGS] [--sftp-extra-args SFTP_EXTRA_ARGS] [--scp-extra-args SCP_EXTRA_ARGS] [--ssh-extra-args SSH_EXTRA_ARGS] [-k |
        --connection-password-file CONNECTION_PASSWORD_FILE] [-C] [-D] [-e EXTRA_VARS] [--vault-id VAULT_IDS] [-J | --vault-password-file VAULT_PASSWORD_FILES] [-f FORKS]
        [-M MODULE_PATH] [--playbook-dir BASEDIR] [--task-timeout TASK_TIMEOUT] [-a MODULE_ARGS] [-m MODULE_NAME]
        pattern
```

### オプション一覧

### Ansible コマンドラインオプション

<Table
  caption="Ansible コマンドラインオプション"
  columns={["オプション", "説明"]}
  data={[
    [
      ["--become-password-file", "--become-pass-file BECOME_PASSWORD_FILE"].join("<br>"),
      "権限昇格用パスワードファイル",
    ],
    [
      ["--connection-password-file", "--conn-pass-file CONNECTION_PASSWORD_FILE"].join("<br>"),
      "接続パスワードファイル",
    ],
    [["--list-hosts"].join("<br>"), "一致するホストのリストを出力します。その他の操作は実行しません"],
    [
      ["--playbook-dir BASEDIR"].join("<br>"),
      "このツールはプレイブックを使用しないため、代替のプレイブックディレクトリとしてこれを使用します。これにより、roles/ group_vars/ など多くの機能の相対パスが設定されます。",
    ],
    [
      ["--task-timeout TASK_TIMEOUT"].join("<br>"),
      "タスクのタイムアウト制限を秒単位で設定します。正の整数でなければなりません。",
    ],
    [["--vault-id VAULT_IDS"].join("<br>"), "使用するボールトID。 この引数は複数回指定できます。"],
    [["--vault-password-file", "--vault-pass-file VAULT_PASSWORD_FILES"].join("<br>"), "ボールトパスワードファイル"],
    [
      ["--version"].join("<br>"),
      "プログラムのバージョン番号、設定ファイルの場所、設定されたモジュール検索パス、モジュールの場所、実行可能ファイルの場所を表示して終了します",
    ],
    [["-B", "--background SECONDS"].join("<br>"), "非同期で実行し、X秒後に失敗します（デフォルト=N/A）"],
    [["-C", "--check"].join("<br>"), "変更を加えずに、発生する可能性のある変更を予測します"],
    [
      ["-D", "--diff"].join("<br>"),
      "(小さな) ファイルやテンプレートを変更する際に、そのファイルの差分を表示します。 --check と組み合わせて使用すると効果的です",
    ],
    [["-J", "--ask-vault-password", "--ask-vault-pass"].join("<br>"), "ボールトパスワードを要求します"],
    [["-K", "--ask-become-pass"].join("<br>"), "権限昇格用パスワードを要求します"],
    [
      ["-M", "--module-path MODULE_PATH"].join("<br>"),
      'モジュールライブラリへのコロン区切りのパスを先頭に追加します（デフォルト={{ ANSIBLE_HOME ~ "/plugins/modules:/usr/share/ansible/plugins/modules" }}）。この引数は複数回指定できます。',
    ],
    [["-P", "--poll POLL_INTERVAL"].join("<br>"), "-B を使用する場合のポーリング間隔を設定します（デフォルト=15）"],
    [
      ["-a", "--args MODULE_ARGS"].join("<br>"),
      'アクションのオプションをスペース区切りのk=v形式で指定します: `-a \'opt1=val1 opt2=val2\'` または JSON 文字列で: `-a \'{"opt1": "val1", "opt2": "val2"}\'`',
    ],
    [
      ["-e", "--extra-vars EXTRA_VARS"].join("<br>"),
      "追加の変数を key=value または YAML/JSON 形式で設定します。ファイル名を指定する場合は `@` を前に付けます。この引数は複数回指定できます。",
    ],
    [["-f", "--forks FORKS"].join("<br>"), "使用する並列プロセス数を指定します（デフォルト=5）"],
    [["-h", "--help"].join("<br>"), "ヘルプメッセージを表示して終了します"],
    [
      ["-i", "--inventory", "--inventory-file INVENTORY"].join("<br>"),
      "インベントリホストのパスまたはカンマ区切りのホストリストを指定します。`--inventory-file` は非推奨です。この引数は複数回指定できます。",
    ],
    [["-k", "--ask-pass"].join("<br>"), "接続パスワードを要求します"],
    [["-l", "--limit SUBSET"].join("<br>"), "選択されたホストを追加のパターンでさらに制限します"],
    [["-m", "--module-name MODULE_NAME"].join("<br>"), "実行するアクションの名前を指定します（デフォルト=command）"],
    [["-o", "--one-line"].join("<br>"), "出力を簡潔にします"],
    [["-t", "--tree TREE"].join("<br>"), "出力をこのディレクトリにログします"],
    [
      ["-v", "--verbose"].join("<br>"),
      "Ansible がより多くのデバッグメッセージを表示するようにします。`-v` を複数回追加すると冗長性が増し、組み込みプラグインは現在 `-vvvvvv` まで評価します。開始するには `-vvv` が適切なレベルで、接続デバッグには `-vvvv` が必要な場合があります。この引数は複数回指定できます。",
    ],
  ]}
/>

<Table
  caption="Privilege Escalation Options"
  columns={["オプション", "説明"]}
  data={[
    [
      ["--become-method BECOME_METHOD"].join("<br>"),
      "権限昇格方法を指定します（デフォルト=sudo）。有効な選択肢を一覧表示するには `ansible-doc -t become -l` を使用します。",
    ],
    [["--become-user BECOME_USER"].join("<br>"), "このユーザーとして操作を実行します（デフォルト=root）。"],
    [["-b", "--become"].join("<br>"), "権限昇格を使用して操作を実行します（パスワードのプロンプトを意味しません）。"],
  ]}
/>

<Table
  caption="Connection Options"
  columns={["オプション", "説明"]}
  data={[
    [["--private-key", "--key-file PRIVATE_KEY_FILE"].join("<br>"), "このファイルを使用して接続を認証します。"],
    [["--scp-extra-args SCP_EXTRA_ARGS"].join("<br>"), "scp のみで渡す追加の引数を指定します（例: -l）。"],
    [["--sftp-extra-args SFTP_EXTRA_ARGS"].join("<br>"), "sftp のみで渡す追加の引数を指定します（例: -f, -l）。"],
    [
      ["--ssh-common-args SSH_COMMON_ARGS"].join("<br>"),
      "sftp/scp/ssh に共通して渡す引数を指定します（例: ProxyCommand）。",
    ],
    [["--ssh-extra-args SSH_EXTRA_ARGS"].join("<br>"), "ssh のみで渡す追加の引数を指定します（例: -R）。"],
    [
      ["-T", "--timeout TIMEOUT"].join("<br>"),
      "接続タイムアウトを秒単位で上書きします（デフォルトは接続によります）。",
    ],
    [["-c", "--connection CONNECTION"].join("<br>"), "使用する接続タイプを指定します（デフォルト=ssh）。"],
    [["-u", "--user REMOTE_USER"].join("<br>"), "このユーザーとして接続します（デフォルト=None）。"],
  ]}
/>

### 例: Ansible コマンドの実行

playbook を利用せずに、直接 ansible サービスで対象のノードに実行を行う。

```bash frame=none
ansible ホスト -m モジュール
```
