---
title: インベントリ
description: インベントリについて
tags:
  - "Ansible"
sidebar:
  # このリンクのカスタムラベルを設定します
  label: インベントリ
  # このリンクの順番をカスタマイズします（数字が小さいほど上に表示されます）
  order: 20
  # このリンクにバッジを追加します
  # badge:
  #     text: ""
  #     variant: tip
---

import { LinkCard, Tabs, TabItem, Steps, FileTree } from "@astrojs/starlight/components";
import LinkPreview from "@components/LinkPreview.astro";
import MermaidChart from "@components/MermaidChart.astro";
import Table from "@components/Table.astro";

## インベントリの基本

### YAML での宣言のメリット

Playbook は、ターゲットノードに"何をする"かを宣言しています。インベントリでは、どこに実行するのか？
つまり、ターゲットノードの指定方法についてを宣言しているファイルとなります。

インベントリファイルは、INI 形式、YAML 形式 のファイルで指定することができます。

```ini
web01

192.18.0.219
# 10 台を連番で指定する方法
app[1:10]
```

```ini
[web]
web01
web02

[app]
app01
app02
```

```yaml title="/etc/ansible/example.yaml"
all:
  hosts:
    web01:
      ansible_host: 192.168.1.10
    web02:
      ansible_host: 192.168.1.11
  children:
    webservers:
      hosts:
        web01:
        web02:
```

インベントリでのターゲットノードの指定方法は、IP アドレスか、ホスト名となります。ホスト名は名前解決が必要です。

### ホストグループ

インベントリには Ansible で管理する対象のノードを記載していきますが、
実行対象が単体のノードではなく複数のノードに実行するには、ホストグループを設定して実行することができます。
これは、環境ごとに実行するなどのときに便利です。

```ini title="ini形式のホストグループ"
[web]
web01
web02

[app]
app01
app02
```

web というグループと、app というグループにわけた書き方です。web01 と web02 に実行したい場合は web グループに対して Playbook を実行することになる。
また、ホストグループに階層を作り、以下のような三層構造でのホストグループ設定をすることもできる。

```ini
[web:children]
tokyo_web
osaka_web

[tokyo_web]
tokyo_web01
tokyo_web02

[osaka_web]
osaka_web01
osaka_web02
```

東京と大阪で環境を分け、ansible を実行したい時などに利用できる。

### インベントリ内の変数

#### ホスト変数

ターゲットノード単体に対して定義する変数

##### INI 形式

```ini
[web]
web01 ansible_user=ops http_port=80
web02 ansible_user=ops http_port=80
```

##### YAML 形式

```yaml
all:
  children:
    web:
      hosts:
        web01:
          ansible_user: ops
          http_port: 80
        web02:
          ansible_user: ops
          http_port: 80
```

#### グループ変数

グループホストに対して定義する変数。`[グループ名:vars]` という形で指定

##### INI 形式

```ini
[web]
web01 ansible_user=ops http_port=80
web02 ansible_user=ops http_port=80
```

のをグループ変数で書き換えると

```ini
[web]
web01
web02

[web:vars]
ansible_user=ops
http_port=80
```

`[web:vars]` としてグループで同じ値を利用する時にこのように書くことができる

##### YAML 形式

```yaml
all:
  children:
    web:
      hosts:
        web01: # 個別の値を利用する場合、ここにネストして変数を定義できる
        web02:
      vars:
        ansible_user: ops
        http_port: 80
```

#### ファイルに変数を定義して利用する

Playbook が存在するディレクトリ内に group_vars、host_vars というディレクトリを作成し、
その配下にそれぞれのホスト名ファイルを用意して、変数を定義して管理することができる。

<FileTree>

- group_vars
  - web
  - app
- host_vars
  - web01
  - web02
  - app01
  - app02

</FileTree>
