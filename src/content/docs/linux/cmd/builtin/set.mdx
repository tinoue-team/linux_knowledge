---
title: set
description: 利用するシェル(bash)の設定を行う
tags:
    - "Linux"
    - "bash 組み込みコマンド"
sidebar:
    # このリンクのカスタムラベルを設定します
    label: set
    # このリンクの順番をカスタマイズします（数字が小さいほど上に表示されます）
    order: 2
    # このリンクにバッジを追加します
    # badge:
    #     text: ""
    #     variant: tip
---

import { LinkCard, Tabs, TabItem } from "@astrojs/starlight/components";
import LinkPreview from "@components/LinkPreview.astro";
import Table from "@components/Table.astro";

## 説明

set コマンドはオプションを指定せずに実行すると、シェル変数、シェル関数を一覧表示する。
オプションで、現在利用しているシェルの設定を変更することができる。

### 構文

```bash frame=none
# シェル変数、シェル関数を一覧表示
set

set -o <shell option> # シェルオプションを有効にする
set +o <shell option> # シェルオプションを有効にする
```

#### オプションの設定と解除

オプション文字に対して、`-` をつけると有効、`+` をつけると無効になる

```bash frame=none
# errexit オプション(エラーチェックを厳格にする)を有効にする
set -e

# errexit オプションを無効にする
set +e
```

## オプション

### オプション一覧

<Table
    caption=""
    colWidth={["8.7rem"]}
    columns={["オプション", "説明"]}
    data={[
        [
            ["`-a`", "(allexport)"].join("<br>"),
            "各変数や関数が作成または変更されると、自動的に `export` 属性が付与され、以降のコマンドの環境にエクスポートされます。",
        ],
        [
            ["`-b`", "(notify)"].join("<br>"),
            "終了したバックグラウンドジョブのステータスを即座に報告します。ジョブ管理が有効な場合にのみ効果を発揮します。",
        ],
        [
            ["`-e`", "(errexit)"].join("<br>"),
            [
                "パイプライン、リスト、または複合コマンドが非ゼロのステータスで終了した場合に即座にシェルを終了します。ただし、特定の状況下ではシェルは終了しません。",
                "パイプライン（単一の単純なコマンドで構成される）、リスト、または複合コマンド（上記の SHELL GRAMMAR を参照）がゼロ以外のステータスで終了した場合、直ちに終了する。失敗したコマンドが `while` または `until` キーワードの直後のコマンドリストの一部、`if` または `elif` 予約語に続くテストの一部、最後の `&&` または `||` に続くコマンドを除く `&&` または `||` リストで実行されるコマンドの一部、パイプラインの最後のコマンド以外のコマンド、コマンドの戻り値が `!` で無視されている間にコマンドが失敗したため、サブシェル以外の複合コマンドがゼロ以外のステータスを返した場合、シェルは終了しない。`ERR` のトラップが設定されている場合は、シェルが終了する前に実行されます。このオプションは、シェル環境と各サブシェル環境に個別に適用され (上記の「COMMAND EXECUTION ENVIRONMENT」を参照)、サブシェル内のすべてのコマンドを実行する前にサブシェルが終了することがあります。",
                "eが無視されるコンテキストで複合コマンドまたはシェル関数が実行される場合、`-e` が設定されているコマンドで失敗ステータスが返されたとしても、複合コマンドまたは関数本体内で実行されるコマンドはいずれも `-e` 設定の影響を受けません。`-e` が無視されるコンテキストで実行中に複合コマンドまたはシェル関数が `-e` を設定した場合、その複合コマンドまたは関数呼び出しを含むコマンドが完了するまで、その設定は影響を及ぼしません。",
            ].join("<br>"),
        ],
        [
            ["`-f`", "(noglob)"].join("<br>"),
            "パス名展開（グロブ）を無効にします。ワイルドカード (`*`, `?` など) をリテラルとして扱います。",
        ],
        [["`-h`", "(hashall)"].join("<br>"), "コマンドの実行場所を記憶します。デフォルトで有効です。"],
        [
            ["`-k`", "(keyword)"].join("<br>"),
            "コマンドの環境に配置されるのは、コマンド名の前にあるものだけでなく、全ての代入文形式の引数です。",
        ],
        [
            ["`-m`", "(monitor)"].join("<br>"),
            "モニターモード。ジョブ管理を有効にします。インタラクティブシェルではデフォルトで有効です。すべてのプロセスが個別のプロセスグループで実行されます。バックグラウンドジョブが完了すると、その終了ステータスを含む行がシェルに表示されます。",
        ],
        [
            ["`-n`", "(noexec)"].join("<br>"),
            "コマンドを読み込むだけで実行しません。シェルスクリプトの構文エラーチェックに使用します。インタラクティブシェルでは無視されます。",
        ],
        [
            "`-o option-name`",
            "特定のオプションを有効または無効にします。オプション名には `allexport`、`braceexpand`、`emacs` などがあります。[参照](# -o オプションの説明)",
        ],
        [
            ["`-p`", ""].join("<br>"),
            [
                "特権モードを有効にします。このモードでは `$ENV` や `$BASH_ENV` ファイルが処理されず、環境からシェル関数が継承されず、特定の環境変数が無視されます。",
                "Turn on privileged mode.  In this mode, the $ENV and $BASH_ENV files are not processed, shell functions are not inherited from the  environment,  and  the SHELLOPTS,  BASHOPTS,  CDPATH,  and GLOBIGNORE variables, if they appear in the environment, are ignored.  If the shell is started with the effective user (group) id not equal to the real user (group) id, and the -p option is not supplied, these actions are taken and the effective user id is set to the  real user id.  If the -p option is supplied at startup, the effective user id is not reset.  Turning this option off causes the effective user and group ids to be set to the real user and group ids.",
            ].join("<br>"),
        ],
        [["`-t`", "(onecmd)"].join("<br>"), "1つのコマンドを読み込んで実行した後にシェルを終了します。"],
        [
            ["`-u`", "(nounset)"].join("<br>"),
            "パラメータ展開時に、未設定の変数やパラメータ（`@` と `*` を除く）をエラーとして扱います。",
        ],
        [["`-v`", "(verbose)"].join("<br>"), "シェルが読み込んだ各コマンドを表示します。"],
        [["`-x`", "(xtrace)"].join("<br>"), "各コマンドとその引数を表示します。デバッグに有用です。"],
        [["`-B`", "(braceexpand)"].join("<br>"), "ブレース展開を有効にします。デフォルトで有効です。"],
        [
            ["`-C`", "(noclobber)"].join("<br>"),
            "`>`, `>&`, `<>` リダイレクション演算子で既存のファイルを上書きしません。`>`",
        ],
        [["`-E`", "(errtrace)"].join("<br>"), "ERR トラップをシェル関数、コマンド置換、サブシェル環境に継承します。"],
        [
            ["`-H`", "(histexpand)"].join("<br>"),
            "`!` スタイルの履歴展開を有効にします。インタラクティブシェルではデフォルトで有効です。",
        ],
        [
            ["`-P`", "(physical)"].join("<br>"),
            ["シンボリックリンクを解決せずに物理的なディレクトリ構造を使用します。"].join("<br>"),
        ],
        [
            ["`-T`", "(functrace)"].join("<br>"),
            "DEBUG と RETURN のトラップをシェル関数、コマンド置換、サブシェル環境に継承します。",
        ],
        [["`--`", ""].join("<br>"), "オプションの終了を示し、以降の引数を位置パラメータとして扱います。"],
        [
            "`-`",
            "オプションの終了を示し、残りの引数を位置パラメータに割り当てます。`-x` と `-v` オプションが無効になります。",
        ],
    ]}
/>

### -o オプションの説明

<Table
    caption=""
    colWidth={["6rem"]}
    columns={["オプション名", "説明"]}
    data={[
        [
            "allexport",
            [
                "`-a` と同じ。変数や関数を自動的にエクスポートします。",
                "変数や関数を自動的にエクスポートし、以降のコマンドで利用可能にします。",
            ].join("<br>"),
        ],
        ["braceexpand", "`-B` と同じ。ブレース展開を有効にします。"],
        [
            "emacs",
            "Emacsスタイルのコマンドライン編集インターフェースを使用します。インタラクティブシェルではデフォルトで有効です。",
        ],
        ["errexit", "`-e` と同じ。エラー発生時にシェルを終了します。"],
        ["errtrace", "`-E` と同じ。ERR トラップを継承します。"],
        ["functrace", "`-T` と同じ。DEBUG と RETURN トラップを継承します。"],
        ["hashall", "`-h` と同じ。コマンドの実行場所を記憶します。"],
        ["histexpand", "`-H` と同じ。`!` スタイルの履歴展開を有効にします。"],
        ["history", "コマンド履歴を有効にします。インタラクティブシェルではデフォルトで有効です。"],
        ["ignoreeof", "シェルコマンド `IGNOREEOF=10` が実行されたかのように動作します。"],
        ["keyword", "`-k` と同じ。代入文形式の引数を環境に配置します。"],
        ["monitor", "`-m` と同じ。ジョブ管理を有効にします。"],
        ["noclobber", "`-C` と同じ。リダイレクションで既存のファイルを上書きしません。"],
        ["noexec", "`-n` と同じ。コマンドを読み込むだけで実行しません。"],
        ["noglob", "`-f` と同じ。パス名展開を無効にします。"],
        ["nolog", "現在無視されています。"],
        ["notify", "`-b` と同じ。バックグラウンドジョブのステータスを即座に報告します。"],
        ["nounset", "`-u` と同じ。未設定の変数をエラーとして扱います。"],
        ["onecmd", "`-t` と同じ。1つのコマンド実行後にシェルを終了します。"],
        ["physical", "`-P` と同じ。物理的なディレクトリ構造を使用します。"],
        [
            "pipefail",
            "パイプラインのリターン値を最後に非ゼロで終了したコマンドの値に設定します。デフォルトでは無効です。",
        ],
        ["posix", "Bashの動作をPOSIX標準に合わせて変更します。"],
        ["privileged", "`-p` と同じ。特権モードを有効にします。"],
        ["verbose", "`-v` と同じ。シェルが読み込んだ各コマンドを表示します。"],
        ["vi", "Viスタイルのコマンドライン編集インターフェースを使用します。"],
        ["xtrace", "`-x` と同じ。コマンドとその引数を表示します。"],
    ]}
/>

### オプションのデフォルト設定

ほとんどのオプションはデフォルトで無効になっていますが、いくつかはデフォルトで有効です。例えば、`-h`（コマンドのハッシュ記憶）はデフォルトで有効です。

### 使用例

#### リダイレクションの上書きを禁止させる

```bash frame=none
ls
a  file

# カレントディレクトリの内容を file ファイルに出力
ls > file
cat file
a
file

# リダイレクション”>”による上書きを禁止
set -o noclobber
ls > file
bash: file: cannot overwrite existing file

# noclobber の解除
set +o noclobber
ls > file # リダイレクション”>”による上書きが成功
cat file
```
