---
title: ジャーナリング
description: ジャーナリングについての説明。各パーティション上でデータを管理・整理する方法
tags:
    - "Linux"
    - "ハードウェア機器"
sidebar:
    # このリンクのカスタムラベルを設定します
    label: ジャーナリング
    # このリンクの順番をカスタマイズします（数字が小さいほど上に表示されます）
    order: 4
    # このリンクにバッジを追加します
    # badge:
    #     text: ""
    #     variant: tip
---

import { LinkCard, Tabs, TabItem, Steps, FileTree } from "@astrojs/starlight/components";
import LinkPreview from "@components/LinkPreview.astro";
import Table from "@components/Table.astro";

## ジャーナリングとは

\*ジャーナリング（Journaling）\*\*は、ファイルシステムにおけるデータの整合性を保つための仕組みです。特に、電源障害やシステムクラッシュなどの不意の障害が発生した際に、ファイルシステムの破損を防ぎ、迅速な復旧を可能にします。

### ジャーナリングの仕組み

ジャーナリングファイルシステムでは、データの変更を行う前に「ジャーナル」と呼ばれる専用の領域に変更内容を記録（ログ）します。このプロセスにより、システム障害が発生した場合でも、ジャーナルを参照して未完了の操作を復元またはロールバックすることが可能です。

#### 具体的な手順は以下の通り

<Steps>

1. トランザクションの開始

    ファイルシステムに対する変更操作（例：ファイルの作成、削除、書き込み）が開始される。

1. ジャーナルへの記録

    変更内容の詳細（どのファイルがどう変更されるか）がジャーナルに書き込まれる。  
    この時点ではまだ実際のデータには変更が加えられていない。

1. データの変更

    ジャーナルへの記録が完了した後、実際のファイルシステムに対してデータの変更が行われる。

1. コミット

    変更が正常に完了したことをジャーナルに記録し、トランザクションを完了させる。

1. ジャーナルのクリーンアップ

    完了したトランザクションのログをジャーナルから削除する。

</Steps>

### ジャーナリングの利点

#### 迅速な復旧

システム障害後、ジャーナルを参照することで未完了の操作を特定し、ファイルシステムの整合性を迅速に回復できます。

#### データの整合性保持

ジャーナリングにより、ファイルシステムが常に一貫性のある状態を保ちやすくなります

#### パフォーマンスの向上

多くの変更がジャーナルにまとめて記録されるため、ディスクへの書き込み回数を減らし、全体的なパフォーマンスが向上します。

### ジャーナリングの種類

ジャーナリングには主に以下の 2 種類があります：

1. **メタデータジャーナリング**:
    - ファイルのメタデータ（ファイルの属性やディレクトリ構造など）の変更のみをジャーナルに記録します。
    - 比較的高速でオーバーヘッドが少ないですが、データ自体の整合性は保証されません。
2. **フルジャーナリング**:
    - メタデータだけでなく、ファイルのデータ変更もジャーナルに記録します。
    - データの完全な整合性が保証されますが、オーバーヘッドが大きくなります。

### 主なジャーナリングファイルシステム

Linux で広く利用されているジャーナリングファイルシステムには以下のものがあります：

-   **ext3**:
    -   古典的なジャーナリングファイルシステム。メタデータジャーナリングをサポートします。
-   **ext4**:
    -   ext3 の後継で、メタデータジャーナリングに加えてオプションでデータジャーナリングもサポートします。
    -   パフォーマンスと信頼性が向上しています。
-   **XFS**:
    -   高性能なジャーナリングファイルシステムで、大規模なファイルやファイルシステムに適しています。
    -   特にマルチスレッド環境でのパフォーマンスが優れています。
-   **Btrfs**:
    -   次世代のファイルシステムで、ジャーナリングに加えてスナップショット、圧縮、RAID 機能など高度な機能を提供します。
    -   データの整合性と柔軟性に優れています。

### ジャーナリングの注意点

-   **ディスクスペースの使用**:
    -   ジャーナリングには追加のディスクスペースが必要です。ただし、現代のストレージ容量では大きな問題とはならないことが多いです。
-   **パフォーマンスへの影響**:
    -   フルジャーナリングはメタデータジャーナリングに比べてオーバーヘッドが大きいため、パフォーマンスに影響を与える可能性があります。用途に応じて適切なジャーナリングモードを選択することが重要です。

### まとめ

ジャーナリング機能は、ファイルシステムの信頼性とデータの整合性を向上させる重要な仕組みです。特にサーバー環境や重要なデータを扱うシステムでは、ジャーナリングをサポートするファイルシステムを選択することが推奨されます。Linux では、**ext4**や**XFS**、**Btrfs**など、用途や必要な機能に応じてさまざまなジャーナリングファイルシステムを選ぶことができます。
