---
title: パーティション
description: パーティションについての説明。ディスクを分割した論理的な領域、svd?1、svd?2 などと表示される
tags:
    - "Linux"
    - "ハードウェア機器"
sidebar:
    # このリンクのカスタムラベルを設定します
    label: パーティション
    # このリンクの順番をカスタマイズします（数字が小さいほど上に表示されます）
    order: 3
    # このリンクにバッジを追加します
    # badge:
    #     text: ""
    #     variant: tip
---

import { LinkCard, Tabs, TabItem, Steps, FileTree } from "@astrojs/starlight/components";
import LinkPreview from "@components/LinkPreview.astro";
import Table from "@components/Table.astro";

## パーティション(partition)とは

### 説明

Linux ではディスク装置を分割して利用している。分割された部分をパーティションと呼びます。

-   パーティションとは、ハードディスクの保存領域を複数の独立した領域に区切ったものです。それぞれの領域は独立してフォーマットやファイルシステムを持つことができ、異なる用途やオペレーティングシステムで使用されます。
-   ハードディスクや SSD の物理的なストレージデバイスを、複数の論理的な領域に分割したもの
-   windows では “`?ドライブ`”、linux では “`/dev/sd?`” として利用している

#### 利用方法

システムにディスクを接続して、利用できるようにするには、パーティションに分割しパーティションごとにファイルシステムを作成し、ルートファイルシステムにマウントする必要があります。

### 目的

データの分離、異なるファイルシステムの使用、マルチブート環境の構築など

### 種類

パーティションの規格には古くからある MBR (Master Boot Record)形式と新しい GPT (GUID Partition Table) 形式がある。

#### MBR 形式のパーティションの場合

<Table
    caption=""
    columns={["種類", "説明"]}
    data={[
        [
            ["プライマリパーティション", "(基本パーティション)"].join('<br>'),
            [
                "1 台のディスクに必ず 1 つ以上存在するパーティション。",
                "<span style='color=red'>最大で4つ作成</span>することができ、1 ~ 4 つ作成することができ、 1 ~ 4 までの番号が割り当てられる。",
                "基本パーティションの1つを論理パーティションとして利用するには、拡張パーティションに割り当てる。"
            ].join('<br>')
        ],
        ["拡張パーティション",
            [
                "プライマリパーティションの１つのみを拡張パーティションとして定義し、直接ファイルシステムを作成するのではなく、その中にさらに論理パーティションを作成できる。"
            ].join('<br>')
        ],
        ["論理パーティション", ["拡張パーティション内に作成される追加のパーティション。パーティション番号は 5 以上が割り当てられる"].join('<br>')],

    ]}

/>

![MBR パーティションの分割](@assets/linux/posts/hardware/2024-09-30_8.38.51.webp)

:::caution

MBR 方式で利用できるディスクは 最大 2 TiB。それを超える大容量ディスクを利用するには、GPT 方式を使う必要があります。

##### テビバイト(Tebibyte)

定義: 1TiB は 2^40 バイト(1,099,511,627,776 バイト)
テラバイト(TB) との違いは、1TB は　 10^12 バイト(**1,000,000,000,000 バイト**)となり、

-   1 TB = 1,000 GB = 10^12 バイト
-   1 TiB = 1,024 GiB = 2^40 バイト ≈ 1.10 TB

となる。

この違いは、特に大容量のストレージを扱う際に重要です。メーカーが製品の容量を TB で表示する場合、実際の OS 上では TiB で計算されるため、同じ数値でも容量が異なって見えることがあります。

:::

#### GPT 形式

GPT 方式の場合には 1 つのディスクに最大 128 個のパーティションを作成することができます。(理論上では、9.4 ZiB (ゼビバイト))プライマリパーティション、拡張パーティション、論理パーティションの区別はない。

![GPT パーティションの分割](@assets/linux/posts/hardware/partition-gpt.webp)

:::caution[BIOS/UEFI との関連]

-   BIOS は MBR と GPT の 2 つのパーティション規格に対応していますが、UEFI は GPT のみを扱います。
-   MBR パーティションの場合、ブートローダーは起動デバイスの先頭にある MBR (Master Boot Record) 領域に格納されている。
-   GPT パーティションの場合には、ブートローダーは起動デバイスの ESP (EFI System Partition) に格納されています。ESP は /boot/efi にマウントされます。

:::

パーティションは、ハードディスクの保存領域を複数の独立した領域に分割することで、データ管理やシステム管理を容易にするための手法。
各パーティションは独立したフォーマットやファイルシステムを持つことができる。

### ドライブのパーティション

#### HDD/SSD と「ドライブ」の関係

製造直後の状態の HDD ドライブ、SSD ドライブにはデータを読み書きすることができない。
専用のソフトを使って “**フォーマット**”という操作を行うことで、データの読み書きが可能になる。
こうして読み書きが可能になった HDD/SSD を「**ドライブ**」という。windows ではドライブ。mac、UNIX では、sda などファイルで管理する

#### 1 台の HDD/SSD に複数のドライブを作る「パーティション」機能

1 台の HDD/SSD には 1 つのドライブを作成して使うのが普通です。しかし、HDD/SSD の内部を複数の領域に分割することで、複数のドライブを作成することもできます。この領域それぞれを “パーティション”といいます。

##### C ドライブ

OS とアプリケーションをインストールするためのパーティション

##### D ドライブ

ユーザデータを保存するための別のパーティション

##### リカバリパーティション

システムのリカバリデータを保存するためのパーティション

#### パーティションを分割するメリット

パーティション分割を行う１番のメリットは**「システム用ドライブ」**と**「データ用ドライブ」**を分けられるということ。

##### 「システム用ドライブ」と「データ用ドライブ」

システム用ドライブとは、OS がインストールされているドライブで、Windows では C ドライブが該当。

例えば、パーティション分割を行っていない HDD/SSD で、Windows をクリーンインストール(内容を全消去してインストール)すると、C ドライブに入っているデータ(「ドキュメント」や「ピクチャ」フォルダなどに保存されているファイルなど)は、クリーンインストールと同時に消えてしまう。残しておきたいデータは一旦他の HDD/SSD などにバックアップしなければならない。

しかし、パーティション分割を行い、「C ドライブにシステム」「D ドライブにデータ」という使い分けをしておけば、C ドライブに Windows をクリーンインストールしても D ドライブのデータはそのまま残るというわけです。

その他のメリットとしては、読み書きトラブルに強くなるという点が挙げられる。HDD/SSD の各ドライブには「管理領域」という領域があり、この部分が破損してしまうとドライブ全体が読み書きできなくなってしまうことがある。
HDD/SSD を一つのドライブとして使っている場合は、そのドライブの管理領域が壊れてしまうとすべて読み書き不能になってしまう。一方、パーティション分割を行って、複数のドライブが認識されている場合には、１つのドライブの管理領域に不具合が起きたとしても、他のドライブは正常に動作する。

#### パーティションを分割するデメリット

大きなデメリットは容量を効率的に使えなくなるということ。
例えば、1TB の HDD/SSC を、システム用の「C ドライブ: 800 GB」、データ用の「D ドライブ: 200 GB」と分割したとしましょう。すると、D ドライブに大量の文書や写真・楽曲・動画などを保存して 200 GB 近くになってしまった場合に、「C ドライブには多くの空き領域があるのに、D ドライブは容量不足」という事態が発生する。
だからといって C ドライブにもデータを保存するようになっては、データの保管ドライブが二箇所になって管理が煩雑になり、「システムドライブとデータドライブを分ける」というメリットもなくなります。

D ドライブを効率よくデータ用ドライブとして利用するためには、「ドキュメント」「ミュージック」「ビデオ」といったフォルダを D ドライブに移す設定が必要になる。その他、アプリごとにデータ保存用フォルダを D ドライブに設定しなおさなければならないケースもあり、これはパソコンに慣れていない人には難しい作業かもしれません。

## 種類別

### 物理パーティション

定義: 実際のハードディスクの保存領域を区切ったもの。プライマリパーティションと拡張パーティションを含む

![物理パーティションの分割](@assets/linux/posts/hardware/partition1.webp)

#### プライマリパーティション(基本パーティション)

システムの起動ができるパーティションのこと。ドライブ C のようにプライマリパーティション１つにつき、１つのドライブの割り当てがあります。
Window の場合、作成できるのは４つまで。(Linux も)

Linux では、ファイルシステムによって管理されているため、ハードディスクが `/dev/sda` の場合、`/dev/sda1` ~ `/dev/sda4` (最大 4 つまで)となる

#### 拡張パーティション

システム起動ができないパーティションのこと。作成しただけではドライブとして認識されない。
特徴は、複数の論理ドライブを作成でき、各ドライブに名前を割り当てられるので、分割数を増やして管理やすい

Linux では、拡張パーティションの中にはファイルシステムではなく、論理パーティションが格納される

### 論理ドライブ・論理パーティション

ハードディスクの数が物理ドライブであるのに対し、論理ドライブはパーティションよるドライブのこと。実際に割り当てられたドライブを指す。

### 回復パーティション

ドライブの他に、パーティションには回復パーティションと呼ばれるものもあります。出荷時の状態に戻す時に必要なもので、リカバリーのための領域です。

## パーティションに分割する

### パーティションに分割する

Linux のファイルシステムでは一般的にルートディレクトリの下に多数のディレクトリがあります。それらを一つのルートパーティションとして構成することも可能ですが、以下の理由から複数のパーティションに分割することが推奨されています。

-   障害発生時に被害が波及する範囲を限定する
-   特定のユーザが過大にディスク容量を使用した場合の影響を、当該パーティションに限定し、システム全体への影響を防ぐ
-   パーティションごとにバックアップを取る

ファイルシステム用パーティション以外に、スワップ領域として使われる「スワップパーティション」が必要です。メモリが不足すると、メモリ内容の一部をスワップ領域に退避することによって、システムダウンを防いで、処理を継続します。

### FHS (Filesystem Hierarchy Standard)とパーティション分割

Linux の動作仕様上、ファイルシステム内のディレクトリの名称に制約はないがマシン毎に異なるディレクトリ名が使われると利用者には不便です。そのため、ディレクトリの用途と名称との間に設けられたガイドラインが FHS (Filesystem Hierarchy Standard) です。

パーティション分割は最低、ルートパーティションとスワップパーティションの 2 つがあれば、システムは動作することができる。しかし、FHS の利用用途から少なくとも /boot、/home、/var、/tmp を個別のパーティションとして分割することが一般的。

[Linux ディレクトリの構成](/linux/posts/hardware/linux_directory_structure/)

### 必要性

#### データを整理する(OS とデータの住み分け)

1. 例えば、パーティション１には OS を保存させ、パーティション 2 は写真データ専用の領域とする

    ![OSとデータの棲み分け1](@assets/linux/posts/hardware/volume-partition1.webp)

1. しかし、OS を別のものにしたいとなった時に、パーティションを分けているとデータには影響しなくて済む

    ![OSとデータの棲み分け2](@assets/linux/posts/hardware/volume-partition2.webp)

#### マルチブート(複数 OS の利用)

1. 一つのハードドライブに複数の OS をインストールすることもできる OS ごとにパーティションを分けて利用する

    ![複数OSの利用](@assets/linux/posts/hardware/partition-multi.webp)

一つのパーティションの使用率が 100 % になってしまっても、一方のパーティションには影響を受けないようになる。パーティションで区切られて、一方のパーティションのファイルシステムが壊れたとしてももう一方には影響は受けないなど、被害を最小限にとどめるために利用されたりする。しかし、ディスク自体が壊れてしまえばパーティションが区切られても被害は止めることはできない。

## パーティションの分割をする方法

:::caution
パーティションの分割・変更操作には操作を誤った際に Windows が起動できなくなる、HDD/SSD の内容が消えてしまうなどといったリスクが伴います。
:::

### パーティションの作成コマンド

パーティションの作成、設定変更、削除には、以下のコマンドを使用する。どれを使っても同様の操作が可能です。

## パーティションとボリューム

パーティションは、物理的に離れた区切られた領域で、ボリュームは論理的に区切られた領域

![パーティションとボリューム](@assets/linux/posts/hardware/volume-partition.webp)

物理的に離れたパーティションを論理的に同じ領域として扱うことをボリュームという。
