---
title: Postfix
description: サイト内を移動するためのサイトツリーが表示を説明
tags:
    - "Linux"
    - "Postfix"
sidebar:
    # このリンクのカスタムラベルを設定します
    label: Postfix
    # このリンクの順番をカスタマイズします（数字が小さいほど上に表示されます）
    order: 2
    # このリンクにバッジを追加します
    # badge:
    #     text: ""
    #     variant: tip
---

import { LinkCard, Tabs, TabItem } from "@astrojs/starlight/components";
import LinkPreview from "@components/LinkPreview.astro";
import MermaidChart from "@components/MermaidChart.astro";
import Table from "@components/Table.astro";

## 参考

<LinkPreview url="https://tech-lab.sios.jp/archives/17600" />
<LinkPreview url="https://qiita.com/te2u/items/536687297ed18f0542e3" />

## 概要

### インストール

<Tabs>
    <TabItem label="dnf">
    ```bash
    dnf install postfix
    ```
    </TabItem>

    <TabItem label="apt">
    ```bash
    # mail, postfix コマンドなど
    apt -y install bsd-mailx
    ```
    </TabItem>

</Tabs>

### Postfix とは

Postfix とは、高速に動作するメールサーバのオープンソフトウェア。古くは、UNIX 系で主な MTA として Sendmail が利用されていたが、
設定の複雑さやセキュリティのリスクが問題視されるようになったことで、次世代の MTA ソフトウェアが開発され、その一つが Postfix です。
Sendmail と捜査上の互換性を保ちつつ、安全でメンテナンスがしやすいように改良がされており、Postfix を利用したサーバは高い評価がされている。

## Postfix を構成する主なプログラム

### 関連図

Postfix は、sendmail との互換性を持ちつつ、新規に開発された MTA です。
高速に動作し、設定も容易なため、デフォルトの MTA として採用するディストリビューションが増えています。
Postfix は単一のデーモンプログラムではなく、複数のプログラムが強調して動作する。

<MermaidChart
    chart={`
    graph LR

    %% ****************\*\*\*\***************** 宣言
    mail(受信した<br>メール<br>✉️)

    %% キュー
    subgraph queue
        maildrop[maildrop<br>キュー]:::class1
        incoming[incoming<br>キュー]:::class1
        corrupt[corrupt<br>キュー]:::class1
        active[active<br>キュー]:::class1
        deferred[deferred<br>キュー]:::class1
        hold[hold<br>キュー]:::class1

        flush[flush<br>キュー]:::class1
    end

    %% 処理
    subgraph 外部処理
        mailbox[(サーバ内<br>メール box)]
        out[\外部送信\]
        filter([フィルタ処理<br>外部アプリケーション])

        error[送信エラー]
    end

    subgraph master[ master デーモン ]
        sendmail((sendmail <br> デーモン)):::class2
        pickup((pickup <br> デーモン)):::class2
        smtpd((smtpd <br> デーモン)):::class2

        cleanup((cleanup <br> デーモン)):::class2
        anvil((anvil <br> デーモン)):::class2
        qmgr((qmgr<br>【nqmgr, oqmgr】<br> デーモン)):::class2
        local((local <br> デーモン)):::class2
        pipe((pipe <br> デーモン)):::class2
        smtp((smtp <br> デーモン)):::class2
        bounce((bounce <br> デーモン)):::class2
        tlsmgr((tlsmgr <br> デーモン)):::class2
    end

    %% ****************\*\*\*\***************** 関連

    mail ==>|外部から<br>メールを受信| smtpd

    %% デーモン同士の連携
    pickup -->|検出したメールを<br>形式チェック| cleanup
    smtpd -->|検出したメールを<br>形式チェック| cleanup

    anvil ~~~ cleanup
    smtpd ---|外部からの<br>接続数を制限| anvil

    qmgr -->|配送先を見て<br>自サーバなら| local
    qmgr -->|配送先を見て<br>リモートなら| smtp
    qmgr -->|配送先を見て<br>外部プログラムなら| pipe
    qmgr ---|⬆️ バウンスメッセージ<br>を渡す| bounce
    smtpd <-->|TLS セッション<br>を開始<br>TLS セッションの<br>キャッシュを再利用| tlsmgr
    tlsmgr <-->|TLS セッションの要求| smtp

    %% 処理との関連
    local ==> mailbox
    smtp ==> out
    pipe ==> filter
    error ==> bounce
    bounce ~~~ error

    %% queue への操作
    sendmail -.->|sendmail コマンドで<br>メールをキューに<br>追加| maildrop
    pickup -.-|⬅️ maildrop キューを監視して<br>格納されたメールを検出| maildrop
    cleanup -.->|ヘッダーの追加・形式<br>を終えたメールを格納| incoming
    cleanup -.->|メールの形式が正しくない<br>・破損している| corrupt
    qmgr -.->|キューに格納された<br>メールを取り出す| incoming
    qmgr -.->|メールが破損している| corrupt
    qmgr <-.->|送信予定メールが入る ▶️<br>| active
    qmgr <-.->|送信エラーメールを一時保管 ▶️<br>◀️ 一定時間後に再試行する| deferred
    postuser(postuser) -.->|postuser コマンドで<br>管理者が手動で<br>メールを保留| hold

    %% スタイル
    classDef class1 fill:#970a61,stroke:#9e5757,stroke-width:0px
    classDef class2 fill:#000a61,stroke:#9e5757,stroke-width:3px

`}
/>

#### メール配送の一般的な流れ

1. **メール送信**:
    - ユーザーが `sendmail` コマンドを使用してメールを送信します。`sendmail` デーモンはメールをローカルキューに格納します。
    - 外部からメールが `smtpd` デーモンによって受信されます。
2. **メールキューへの格納**:
    - `pickup` デーモンがローカルキューからメールを読み取り、`cleanup` デーモンに渡します。
    - `smtpd` デーモンは直接 `cleanup` デーモンにメールを渡します。
3. **メールのフォーマット**:
    - `cleanup` デーモンがメールのフォーマットを行い、`qmgr` デーモンに渡します。
4. **メールの配送**:
    - `qmgr` デーモンがメールを適切なキュー（incoming, active, deferred）に格納します。
    - `qmgr` デーモンはメールを配送するために `smtp`、`local`、`pipe` などの配送デーモンにメールを渡します。
5. **配送失敗時の処理**:
    - メールが配送できない場合、bounce デーモンがバウンスメッセージを生成し、qmgr デーモンに渡します。

#### その他のパターン

-   **TLS 管理**:
    -   `tlsmgr` デーモンは TLS セッションキャッシュの管理を行い、他のデーモンが TLS 情報を取得する際に使用します。
-   **接続制限**:
    -   `anvil` デーモンは `smtpd` デーモンと連携し、接続数の制限を行います。
-   **外部プログラムとの連携**:
    -   `pipe` デーモンは外部プログラムにメールを渡します。

これらのデーモンとキューの連携により、Postfix は効率的で柔軟なメール配送システムを実現しています。

### Daemon List

<Tabs syncKey="postfix-deamons">
    <TabItem label="master">
        ##### 役割

        Postfix の動作全体の制御をするデーモン

        <Table
            columns={["Role", "Description"]}
            data={[
                [
                    '<span class="font-bold">デーモンの起動と停止</span>',
                    "他のすべての Postfix デーモンを起動し、必要に応じて停止する",
                ],
                [
                    '<span class="font-bold">デーモンの監視</span>',
                    "各デーモンの動作状況を監視し、必要に応じて再起動する",
                ],
                [
                    '<span class="font-bold">設定管理</span>',
                    "Postfix の設定に基づいて、適切なデーモンを適切な設定で実行する",
                ],
                [
                    '<span class="font-bold">リソース管理</span>',
                    "システムリソースの使用状況を管理し、効率的な動作を確保する",
                ],
            ]}
        />
        ##### 関連するデーモン、およびキューの流れ

        全てのデーモンを管理する
    </TabItem>

    <TabItem label="sendmail">
        ##### 役割

        Postfix の sendmail コマンド互換プログラム。ローカルユーザーがメールを送信するために使用される。

        ##### 関連するデーモン、およびキューの流れ
        - **daemon**
            - `sendmail` → `maildrop`
    </TabItem>

    <TabItem label="smtpd">
        ##### 役割

        - SMTP サーバープロセス。外部からのメールを受信し、Postfix 内部に渡す。
        - 受信後に cleanup デーモンへ渡される
        - TLS 接続の際に `tlsmgr` 呼び出し、TLS セッションを始める

        ##### 関連するデーモン、およびキューの流れ
        - **daemon**
            - `smtpd` → `cleanup`
            - `smtpd` → `tlsmgr`
    </TabItem>

    <TabItem label="pickup">
        ##### 役割
        - ローカルの maildrop キューを監視し、メッセージを読み取り、処理を開始する。
        - 内部配送(受信後に cleanup に渡す)を処理する

        ##### 関連するデーモン、およびキューの流れ
        - **queue**
            - `maildrop` キュー → `pickup`

        - **daemon**
            - `pickup` → `cleanup`
    </TabItem>

    <TabItem label="cleanup">
        ##### 役割

        受け取ったメールの形式が正しいか確認
        1. メールメッセージのヘッダーをフォーマットし、必要に応じて補完する
        2. メッセージのフォーマットやフィルタリングを行う。
        ヘッダの書き換えなどをおこなって incoming キューに入れ、qmgr に通知する

        ##### 関連するデーモン、およびキューの流れ
        - **queue**
            - `cleanup` キュー → `incoming`

        - **daemon**
            - `cleanup` → `qmgr`
    </TabItem>

    <TabItem label="qmgr">
        ##### 役割

        メールキューマネージャー。キュー内のメールを管理し、配送プロセスを制御する。
        incomingキュー内のメールを配送プログラム(activeキュー)に渡す。

        並行して、active キューと deferred キューを定期チェックしてメールの指定に合わせて smtp、local、pipe デーモンへ渡す

        ##### 関連するデーモン、およびキューの流れ
        - **queue**
            - `incoming` キュー → `qmgr`
            - `qmgr` ↔ `active` キュー、
            - `qmgr` ↔ `deferred` キュー、

        - **daemon**
            - `qmgr` → `smtp`
            - `qmgr` → `local`
            - `qmgr` → `pipe`
    </TabItem>

    <TabItem label="nqmgr">
        ##### 役割

        新しいキューマネージャー。qmgr の代替(配送アルゴリズム)として使用されることがある。
        主にパフォーマンスの向上が目的。

        ##### 関連するデーモン、およびキューの流れ
        `nqmgr` → 各キューに渡す(qmgrと同様)
    </TabItem>

    <TabItem label="smtp">
        ##### 役割

        外部のメールサーバへメールを送信する SMTP クライアントプロセス。
        指定された宛先(リモートの SMTP サーバーに)にメールを外部送信する、リレー先があれば指定先へ送信する。
        無ければドメインの MX 宛に送信する
        送信先サーバーがTLS接続を要求する場合、smtp デーモンは tlsmgr デーモンを呼び出してTLSセッションを開始

        ##### 関連するデーモン、およびキューの流れ
        - **daemon**
            - `qmgr` → `smtp`
            - `smtp` → `tlsmgr`
    </TabItem>

    <TabItem label="bounce">
        ##### 役割

        - バウンスメール(設定ミスなどで行ったり来たりする配送に失敗したメール)を処理するため、
            バウンスメッセージ（エラーメール）を生成する。
        - メール送信元または Return-Path を宛先に変更して defered キューに格納し、再試行が行われる。
            送信エラーで、アドレスが存在しない、拒否された場合に実行される

        ##### 関連するデーモン、およびキューの流れ
        - **daemon**
            - `bounce` → `qmgr`
    </TabItem>

    <TabItem label="local">
        ##### 役割

        - 自サーバ内のメールボックスへメールを配送するローカル配送エージェント。
            main.cf の mydomain で自サーバを判定しているためローカルのメールボックスにメールを配送する。

        ##### 関連するデーモン、およびキューの流れ
        - **daemon**
            - `qmgr` → `local`
    </TabItem>

    <TabItem label="pipe">
        ##### 役割

        - 外部プログラムやサービスと連携してメールを処理するためのプロセス。
            メールをパイプを通じて外部プログラムに渡す。

        ##### 関連するデーモン、およびキューの流れ
        - **daemon**
            - `qmgr` → `pipe`
    </TabItem>

    <TabItem label="trivial-rewrite">
        ##### 役割

        - メールの宛先アドレスを書き換えるプロセス。別名や仮想ドメインの処理を行う。

        ##### 関連するデーモン、およびキューの流れ
        - **daemon**
            - `trivial-rewrite` → `cleanup`
            - `trivial-rewrite` → `qmgr`
    </TabItem>

    <TabItem label="virtual">
        ##### 役割

        仮想ドメインのメールを処理する。仮想メールボックスにメールを配送します。

        ##### 関連するデーモン、およびキューの流れ
        - **daemon**
            - `qmgr` → `virtual`
    </TabItem>

    <TabItem label="proxymap">
        ##### 役割

        メモリ内のデータベースキャッシュを提供。
        Postfix の他のデーモンが使用するデータベースアクセスの高速化を図る。

        ##### 関連するデーモン、およびキューの流れ
        - **daemon**
            - 他のデーモン → `proxymap`
    </TabItem>

    <TabItem label="tlsmgr">
        ##### 役割

        TLS （Transport Layer Security）セッションキャッシュの管理を行う。
        頻繁に接続するクライアントとの間で TLS ハンドシェイクを再利用でき、パフォーマンスが向上する。
        また、TLS キーや証明書の管理も行い、秘密鍵、公開鍵、証明書の読み込み、検証、更新が含まれる。
        他のデーモンがTLS情報を取得する際に使用します。

        ##### 関連するデーモン、およびキューの流れ
        - **daemon**
            - その他のデーモン → `tlsmgr`
    </TabItem>

    <TabItem label="anvil">
        ##### 役割

        smtpd の接続数を制限し、DoS（Denial of Service）攻撃を防ぐ。

        ##### 関連するデーモン、およびキューの流れ
        - **daemon**
            - `smtpd` ↔ `anvil`
    </TabItem>

    <TabItem label="discard">
        ##### 役割

        特定の条件に合致するメールを破棄するプロセス。

        ##### 関連するデーモン、およびキューの流れ
        - **daemon**
            - `qmgr` → `discard`
            - `cleanup` → `discard`
    </TabItem>

</Tabs>

### Queue List

<Tabs syncKey="postfix-queue">
    <TabItem label="maildrop">

        ローカルのユーザーが送信したメールが最初に置かれるキュー。
        ユーザーが送信したメールが postdrop または sendmail
        などのコマンドによって maildrop キューに入ります。
        メールフィルタリングやウイルススキャンなどの処理が行われる前の段階。
        pickup デーモンが定期的にメールを取得しにくる。
    </TabItem>

    <TabItem label="incoming">

        cleanup が済んだ後に格納される。溜まっているキューは qmgr
        デーモンが取得しに来る。
        外部から受信したメールや、maildropキューから移動してきたメールが配置されるキュー。ここでメールの基本的な検証が行われる。
    </TabItem>

    <TabItem label="active">

        送信予定のメールが保持される。
        配信処理中のメールが格納されるキュー。incomingキューから移動してきたメールがここで処理される。
    </TabItem>

    <TabItem label="deferred">

        一時的に配信できなかったメール(ネットワークの問題、受信サーバの一時的なダウンの場合)が保管されるキュー。
        後で再試行される。
    </TabItem>

    <TabItem label="hold">

        管理者の介入が必要なメールが保管されるキュー。手動での確認や処理が必要。
        管理者が `postsuper -h` コマンドを使用してメールを hold
        キューに移動させるために使用されます。 また、 `postsuper -H` コマンドで
        hold キューからメールを解放することもできます。
    </TabItem>

    <TabItem label="corrupt">

        破損したメッセージが隔離されるキュー。通常、管理者の介入が必要。
    </TabItem>

    <TabItem label="corrupt">

        キューマネージャーによって強制的に処理されるメールが一時的に保管されるキュー。
        再送を試みるためにキュー内のすべてのメールを即座に送信しようとするコマンドを実行するためのキュー。
        通常、定期的に（例えば、cronジョブで）実行
    </TabItem>

</Tabs>

### mail log

#### 出力されるログの構文

```bash frame=none
Mon dd hh:mm:ss host postfix/daemon[<PID>]: <queueID>: Header Info
```

-   **`Mon dd hh:mm:ss`** : ログの発生時間、これは設定による
-   **`host`** : マシンのホスト名
-   **`postfix/daemon`**: postfix はどのインスタンスか、postfix だけだと、プライマリインスタンスを示す。daemon でどのデーモンが動いているかを確認
-   **`[<PID>]:`**: プロセス ID
-   **`<queueID>:`**: キュー ID
-   **`Header Info`**: ヘッダー情報

出力されるログの例

```bash frame=none
Dec 27 10:11:32 sv postfix/smtpd[2083]: 3A5AFC00F5: client=xxxxx.net[xxx.xxx.xxx.xxx]
Dec 27 10:11:32 sv postfix/cleanup[1631]: 3A5AFC00F5: message-id=<1234567890abcdefghi@testtest.com>
Dec 27 10:11:32 sv postfix/qmgr[10675]: 3A5AFC00F5: from=<info@testtest.com>, size=5892, nrcpt=1 (queue active)
Dec 27 10:11:32 sv postfix/pipe[1870]: 3A5AFC00F5: to=<xxxxxxxxxxx@yahoo.co.jp>, relay=filter, delay=0.1, delays=0.03/0/0/0.07, dsn=2.0.0, status=sent (delivered via filter service)
Dec 27 10:11:32 sv postfix/qmgr[10675]: 3A5AFC00F5: removed
```

```bash frame=none
                           daemon      PID     queID     ヘッダー情報
                               ↓       ↓        ↓           ↓
～～省略～～
Dec 27 10:11:33 sv postfix-14/pickup[26084]: 38AA31A3C7E: uid=0 from=<info@testtest.com>
Dec 27 10:11:33 sv postfix-14/cleanup[15094]: 38AA31A3C7E: message-id=<1234567890abcdefghi@testtest.com>
Dec 27 10:11:33 sv postfix-14/qmgr[11685]: 38AA31A3C7E: from=<info@testtest.com>, size=5892, nrcpt=1 (queue active)
Dec 27 10:11:33 sv postfix-14/smtp[24435]: 38AA31A3C7E: to=<xxxxxxxxxxx@yahoo.co.jp>, relay=mx3.mail.yahoo.co.jp[202.93.78.241]:25, delay=9620, delays=0.01/0.01/6.7/0.49, dsn=2.0.0, status=sent (250 ok dirdel)
Dec 27 10:11:33 sv postfix-14/qmgr[11685]: 38AA31A3C7E: removed
```

## Postfix の設定

Postfix の設定は、/etc.postfix ディレクトリ以下の main.cf と master.cf で行う。

-   main.cf は MTA としての基本設定ファイル
-   master.cf は、Postfix を構成する各種デーモンの設定ファイル

### main.cf の設定値

#### `compatibility_level`

compatibility_level は、Postfix が main.cf と master.cf の設定に使用するデフォルトの設定を決定します。これらのデフォルトは時間とともに変化します。
システム管理者が main.cf や master.cf に後方互換性のあるデフォルト設定を永続化する必要があるかどうかを判断するまでは、Postfix は後方互換性のあるデフォルト設定を使用し、それらの古い後方互換性のあるデフォルト設定を使用している場所をログに記録します。
このレビューが完了したら、RELEASE_NOTES ファイルで推奨されているように、以下の compatibility_level 設定を更新する。
以下のレベルは（アップグレードではなく）新規インストールで使用すべきものです。

#### `queue_directory`

queue_directory は Postfix のキューの場所を指定します。これは chroot で動作する Postfix デーモンのルートディレクトリでもあります。さまざまな UNIX システムでの Postfix chroot 環境の設定については、 examples/chroot-setup のファイルを参照

#### `command_directory`

すべての postXXX コマンドの格納場所を指定 `command_directory = /usr/sbin`

#### `daemon_directory`

Postfix デーモン・プログラム（すなわち master.cf ファイルにリストされているプログラム）の場所を指定。このディレクトリは root が所有する必要があります。

#### `data_directory`

data_directory パラメータは Postfix が書き込み可能なデータファイル (キャッシュ、乱数) の場所を指定します。
このディレクトリは mail_owner アカウントが所有していなければなりません (以下を参照)。

#### `mail_owner`

Postfix のキューおよびほとんどの Postfix デーモン・プロセスの所有者を指定。 ユーザ ID やグループ ID を他のアカウントと共有しておらず、システム上の他のファイルやプロセスを所有していないユーザアカウントの名前を指定します。 特に、nobody や daemon は指定しないでください。専用ユーザーを使用してください。

#### `default_privs`

外部ファイルまたはコマンドへの配信にローカル配信エージェントが使用するデフォルトの権限を指定します。
これらの権限は、受信者のユーザ・コンテキストがない場合に使用されます。特権ユーザや postfix の所有者を指定しないでください。

#### `soft_bounce`

soft_bounce パラメータはテスト用の限定的なセーフティネットを提供します。
soft_bounce が有効な場合、バウンスするメールはキューに残ります。
このパラメータはローカルで生成されるバウンスを無効にし、SMTP サーバが( 5xx 応答を 4xx 応答に変更することで)メールを永久に拒否することを防ぎます。
しかし、soft_bounce はアドレスの書き換えミスやメールのルーティングミスを防ぐものではありません。

#### `myhostname`

このメール・システムのインターネット・ホスト名を指定します。デフォルトでは、gethostname() からの完全修飾ドメイン名を使用します。
myhostname は、他の多くの設定パラメータのデフォルト値として使用される。

#### `mydomain`

ローカルのインターネット・ドメイン名を指定する。
デフォルトでは、$myhostname から最初の要素を除いたものが使用される。
mydomain は、他の多くの設定パラメータのデフォルト値として使用される。

#### `myorigin`

ローカルに投稿されたメールの送信元ドメインを指定します。デフォルトは $myhostname で、小規模なサイトではこれで十分です。 
複数のマシンでドメインを運用している場合は、(1)これを$mydomain に変更し、(2)ドメイン全体のエイリアスデータベースをセットアップして、
各ユーザーのエイリアスをuser@that.users.mailhost。

送信者と受信者のアドレスの一貫性を保つために、myorigin は、@domain 部分を持たない受信者アドレスに付加されるデフォルトのドメイン名も指定します。
Debian GNU/Linux 特有: ファイル名を指定すると、そのファイルの最初の行が 名前として使われます。 Debian のデフォルトは /etc/mailname です。

#### `inet_interfaces`

メール・システムがメールを受信するネットワーク・インターフェース・アドレスを指定する。 デフォルトでは、マシンのすべてのアクティブなインタフェースを要求します。このパラメータは、user@[ip.address] へのメールの配送も制御します。

プロキシまたはネットワーク・アドレス・トランスレータ経由で転送されるネットワーク・アドレスについては、proxy_interfaces パラメータも参照してください。

:::caution[注意]
このパラメータが変更された場合は、Postfix を停止/起動する必要があります。
:::

#### `proxy_interfaces`

このメール・システムがプロキシまたはネットワーク・アドレス変換ユニットによってメールを受信するネットワーク・インタフェース・アドレスを指定します。この設定は inet_interfaces パラメータで指定したアドレス・リストを拡張します。
システムが他のドメインのバックアップ MX ホストである場合、プロキシ/NAT アドレスを指定する必要があります。そうしないと、プライマリ MX ホストがダウンしたときにメール配信ループが発生します。

#### `mydestination`

このマシンが最終宛先とみなすドメインのリストを指定します。
これらのドメインは、local_transport パラメータ設定で指定された配信エージェントにルーティングされる。デフォルトでは、/etc/passwd と/etc/aliases またはそれに相当するもので、すべての受信者を検索する UNIX 互換の配送エージェントです。

デフォルトは `$myhostname + localhost.$mydomain + localhost` です。 メールドメインゲートウェイでは、`$mydomain` も含める必要があります。

バーチャル・ドメインの名前は指定しないでください - これらのドメインは別の場所で指定されます (VIRTUAL_README を参照)。

このマシンがバックアップ MX ホストとなるドメイン名は指定しないでください。
これらの名前は SMTP サーバーの relay_domains 設定で指定するか、
面倒であれば permit_mx_backup を使用してください（STANDARD_CONFIGURATION_README を参照）。

メール・システムがメールを受信するインタフェース（inet_interfaces パラメータを参照）の
user@[the.net.work.address]宛のメールの最終宛先は、常にローカル・マシンになります。

ホスト名またはドメイン名、/file/name または type:table パターンのリストをカンマまたは空白で区切って指定します。
file/name パターンはその内容で置き換えられ、type:table パターンは、
名前がルックアップ・キーにマッチしたときにマッチします（右辺は無視されます）。
次の行を空白で始めることで、長い行を続けることができる。

See also below, section "REJECTING MAIL FOR UNKNOWN LOCAL USERS".
以下のセクション「 REJECTING MAIL FOR UNKNOWN LOCAL USERS (不明なローカルユーザーのメールを拒否する)」も参照のこと。

#### `local_recipient_maps`

$mydestination、$inet_interfaces または $proxy_interfaces に対して
ローカルなユーザの名前またはアドレスをすべて含むルックアップ・テーブルをオプションで指定します。
このパラメータが定義されている場合、SMTP サーバは不明なローカル・ユーザのメールを拒否します。
このパラメータはデフォルトで定義されています。
SMTP サーバのローカル受信者チェックをオフにするには、以下のように指定します。

#### `unknown_local_recipient_reject_code`

受信者ドメインが `$mydestination` または `${proxy,inet}_interfaces` にマッチし、`$local_recipient_maps` が空でなく、受信者アドレスまたはアドレスのローカル・パートが見つからない場合の SMTP サーバの応答コードを指定します。

デフォルトの設定は 550（メールを拒否する）ですが、local_recipient_maps の設定に問題がないことが確認できるまでは、450（後で再試行する）から始めた方が安全です。

#### `mynetworks_style`

The mynetworks parameter specifies the list of "trusted" SMTP clients that have more privileges than "strangers".

In particular, "trusted" SMTP clients are allowed to relay mail through Postfix. See the smtpd_recipient_restrictions parameter in postconf(5).

You can specify the list of "trusted" network addresses by hand or you can let Postfix do it for you (which is the default).

By default (mynetworks_style = host), Postfix "trusts" only the local machine.

Specify "mynetworks_style = subnet" when Postfix should "trust" SMTP clients in the same IP subnetworks as the local machine. On Linux, this works correctly only with interfaces specified with the "ifconfig" or "ip" command.

Specify "mynetworks_style = class" when Postfix should "trust" SMTP clients in the same IP class A/B/C networks as the local machine. Don't do this with a dialup site - it would cause Postfix to "trust" your entire provider's network. Instead, specify an explicit mynetworks list by hand, as described below.

Specify "mynetworks_style = host" when Postfix should "trust" only the local machine.

#### `mynetworks`

Alternatively, you can specify the mynetworks list by hand, in which case Postfix ignores the mynetworks_style setting.

Specify an explicit list of network/netmask patterns, where the mask specifies the number of bits in the network part of a host address.

You can also specify the absolute pathname of a pattern file instead of listing the patterns here. Specify type:table for table-based lookups (the value on the table right-hand side is not used).

#### `relay_domains`

The relay_domains parameter restricts what destinations this system will relay mail to.  
See the smtpd_relay_restrictions and smtpd_recipient_restrictions descriptions in postconf(5) for detailed information.

By default, Postfix relays mail

-   from "trusted" clients (IP address matches $mynetworks, or is SASL authenticated) to any destination,
-   from "untrusted" clients to destinations that match $relay_domains or subdomains thereof, except addresses with sender-specified routing.

The default relay_domains value is empty.

In addition to the above, the Postfix SMTP server by default accepts mail
that Postfix is final destination for:

-   destinations that match $inet_interfaces or $proxy_interfaces,
-   destinations that match $mydestination
-   destinations that match $virtual_alias_domains,
-   destinations that match $virtual_mailbox_domains.
    These destinations do not need to be listed in $relay_domains.

Specify a list of hosts or domains, /file/name patterns or type:name
lookup tables, separated by commas and/or whitespace. Continue
long lines by starting the next line with whitespace. A file name
is replaced by its contents; a type:name table is matched when a
(parent) domain appears as lookup key.
NOTE: Postfix will not automatically forward mail for domains that
list this system as their primary or backup MX host. See the
permit_mx_backup restriction description in postconf(5).

#### `relayhost`

The relayhost parameter specifies the default host to send mail to when no entry is matched in the optional transport(5) table.
When no relayhost is given, mail is routed directly to the destination.

On an intranet, specify the organizational domain name.
If your internal DNS uses no MX records, specify the name of the intranet gateway host instead.

In the case of SMTP, specify a domain, host, host:port, [host]:port, [address] or [address]:port; the form [host] turns off MX lookups.

If you're connected via UUCP, see also the default_transport parameter.

#### `relay_recipient_maps`

The relay_recipient_maps parameter specifies optional lookup tables with all addresses in the domains that match $relay_domains.

If this parameter is defined, then the SMTP server will reject mail for unknown relay users. This feature is off by default.

The right-hand side of the lookup tables is conveniently ignored. In the left-hand side, specify an @domain.tld wild-card, or specify a user@domain.tld address.

#### `in_flow_delay`

The in_flow_delay configuration parameter implements mail input flow control. This feature is turned on by default, although it still needs further development (it's disabled on SCO UNIX due to an SCO bug).

A Postfix process will pause for $in_flow_delay seconds before accepting a new message, when the message arrival rate exceeds the message delivery rate. With the default 100 SMTP server process limit, this limits the mail inflow to 100 messages a second more than the number of messages delivered per second.
Specify 0 to disable the feature. Valid delays are 0..10.

#### `smtp_helo_name`

### master.cf の設定

### transport の設定
